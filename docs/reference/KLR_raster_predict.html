<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>KLR_raster_predict — KLR_raster_predict • klrfome</title>

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>

<!-- sticky kit -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>



<meta property="og:title" content="KLR_raster_predict — KLR_raster_predict" />

<meta property="og:description" content="`KLR_raster_predict()` predicts a fit KLR model to new data." />
<meta name="twitter:card" content="summary" />



<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">klrfome</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/vignette_intro_and_example_workflow.html">klrfome - Introduction and example workflow</a>
    </li>
  </ul>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/mrecos/klrfome">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>KLR_raster_predict</h1>
    <small class="dont-index">Source: <a href='https://github.com/mrecos/klrfome/blob/master/R/raster_predict_funs.R'><code>R/raster_predict_funs.R</code></a></small>
    <div class="hidden name"><code>KLR_raster_predict.Rd</code></div>
    </div>

    <div class="ref-description">
    
    <p>`KLR_raster_predict()` predicts a fit KLR model to new data.</p>
    
    </div>

    <pre class="usage"><span class='fu'>KLR_raster_predict</span>(<span class='no'>rast_stack</span>, <span class='no'>ngb</span>, <span class='no'>params</span>, <span class='no'>cols</span>, <span class='no'>rows</span>, <span class='kw'>split</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
  <span class='kw'>ppside</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>progress</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>parallel</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
  <span class='kw'>output</span> <span class='kw'>=</span> <span class='st'>"list"</span>, <span class='kw'>save_loc</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>overwrite</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>rast_stack</th>
      <td><p>[raster stack] of prediction rasters (usually scaled)</p></td>
    </tr>
    <tr>
      <th>ngb</th>
      <td><p>[integer] pixel dimension of square neighborhood used to predict model on</p></td>
    </tr>
    <tr>
      <th>params</th>
      <td><p>[list] list of important model parameters. (See example)</p></td>
    </tr>
    <tr>
      <th>split</th>
      <td><p>[logical] TRUE/FALSE for whether to split raster into chunks. If `parallal` == TRUE, then `split` must == TRUE</p></td>
    </tr>
    <tr>
      <th>ppside</th>
      <td><p>[integer] the number of blocks to split the study area into if `split` == TRUE</p></td>
    </tr>
    <tr>
      <th>progress</th>
      <td><p>[logical] if TRUE, displays progress of function</p></td>
    </tr>
    <tr>
      <th>parallel</th>
      <td><p>[logical] if TRUE, prediction will be excuted as parallel computations. Requires a parallel backend, `split` == TRUE, and number for `ppside`</p></td>
    </tr>
    <tr>
      <th>output</th>
      <td><p>[string] either 'list' or 'save'. If 'list', returns list of predicted blocks. If 'save', blocks are saved to save_loc as GeoTiff</p></td>
    </tr>
    <tr>
      <th>save_loc</th>
      <td><p>[string] Location to save raster blocks (GeoTiff). Uses getwd() is NULL</p></td>
    </tr>
    <tr>
      <th>overwrite</th>
      <td><p>[logical] TRUE will overwrite saved raster GeoTiffs in save_loc</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>[raster], [list], or [nothing] - If `parallel` == FALSE, a raster object is returned. If `parallel` == TRUE then either a list of raster objects if `output` == "list", or files are saved as images if `output` == "save"</p>
    
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>`KLR_raster_predict()` - Function predicts the probability of site-presence based on a `rast_stack` raster stack of center/scaled predictor rasters, a focal neighborhood size in cells as `ngb`, and the params list of model fit parameters. Finally, the function also needs to the the number of columns as cols and rows as rows of the study areas raster stack. The rest of the arguments default to predicting the entire raster stack in one pass and only on a single core (not in parallel). The rest of the argument control whether the study area is split (`split` = TRUE) into a grid of blocks. The `ppside` positive integer controls the number of blocks along each axis of the study area. If you wish to compute the prediction in `parallel`, you will need to split it into blocks so that each block can be sent to a different processor core. The final set of optional arguments control how the prediction is returned, either as a `output` = "list" or `output` = "save" for returning a list of rasters of saving each out as a GeoTiff, and then arguments for the GeoTiff location with `save_loc` and whether to overwrite existing GeoTiffs with `overwrite.` The function contains a bit of logic to try and assist the user in which arguments go with what. Perhaps future versions will streamline this a bit.</p>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><span class='co'># NOT RUN {</span>
<span class='co'>### Create param list</span>
<span class='no'>params</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/list'>list</a></span>(<span class='kw'>train_data</span> <span class='kw'>=</span> <span class='no'>train_data</span>,
<span class='kw'>alphas_pred</span> <span class='kw'>=</span> <span class='no'>train_log_pred</span><span class='kw'>[[</span><span class='st'>"alphas"</span>]],
<span class='kw'>sigma</span> <span class='kw'>=</span> <span class='no'>sigma</span>,
<span class='kw'>lambda</span> <span class='kw'>=</span> <span class='no'>lambda</span>,
<span class='kw'>means</span> <span class='kw'>=</span> <span class='no'>formatted_data</span>$<span class='no'>means</span>,
<span class='kw'>sds</span> <span class='kw'>=</span> <span class='no'>formatted_data</span>$<span class='no'>sds</span>)

<span class='co'>### width and hieght of roving focal window (required)</span>
<span class='no'>ngb</span> <span class='kw'>=</span> <span class='fl'>5</span>
<span class='co'>### Number of rows and columns in prediction rasters</span>
<span class='co'>## needed for making simulated rasters, as well as for predicting real-world rasters</span>
<span class='no'>cols</span> <span class='kw'>=</span> <span class='fl'>100</span>
<span class='no'>rows</span> <span class='kw'>=</span> <span class='fl'>100</span>

<span class='co'>### Create simulated environmental rasters  (sim data only) ####</span>
<span class='no'>s_var1r</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>NLMR</span><span class='kw ns'>::</span><span class='fu'><a href='https://www.rdocumentation.org/packages/NLMR/topics/nlm_gaussianfield'>nlm_gaussianfield</a></span>(<span class='no'>cols</span>,<span class='no'>rows</span>, <span class='kw'>autocorr_range</span> <span class='kw'>=</span> <span class='fl'>20</span>)
<span class='no'>s_var1</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='rescale_sim_raster.html'>rescale_sim_raster</a></span>(<span class='no'>s_var1r</span>, <span class='fl'>50</span>, <span class='fl'>10</span>)
<span class='no'>s_var2</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='rescale_sim_raster.html'>rescale_sim_raster</a></span>(<span class='no'>s_var1r</span>, <span class='fl'>3</span>, <span class='fl'>2</span>)
<span class='no'>b_var1r</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>NLMR</span><span class='kw ns'>::</span><span class='fu'><a href='https://www.rdocumentation.org/packages/NLMR/topics/nlm_gaussianfield'>nlm_gaussianfield</a></span>(<span class='no'>cols</span>,<span class='no'>rows</span>,<span class='kw'>autocorr_range</span> <span class='kw'>=</span> <span class='fl'>20</span>)
<span class='no'>b_var1</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='rescale_sim_raster.html'>rescale_sim_raster</a></span>(<span class='no'>b_var1r</span>, <span class='fl'>100</span>, <span class='fl'>20</span>)
<span class='no'>b_var2</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='rescale_sim_raster.html'>rescale_sim_raster</a></span>(<span class='no'>b_var1r</span>, <span class='fl'>6</span>, <span class='fl'>3</span>)
<span class='co'>### Create a site-present trend surface  (sim data only)</span>
<span class='no'>trend_coords</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='sim_trend.html'>sim_trend</a></span>(<span class='no'>cols</span>, <span class='no'>rows</span>, <span class='kw'>n</span> <span class='kw'>=</span> <span class='fl'>3</span>)
<span class='no'>coords</span> <span class='kw'>&lt;-</span> <span class='no'>trend_coords</span>$<span class='no'>coords</span>
<span class='no'>trend</span> <span class='kw'>&lt;-</span> <span class='no'>trend_coords</span>$<span class='no'>trend</span>
<span class='no'>inv_trend</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/MathFun'>abs</a></span>(<span class='fl'>1</span>-<span class='no'>trend</span>)
<span class='no'>var1</span> <span class='kw'>&lt;-</span> (<span class='no'>s_var1</span> * <span class='no'>trend</span>) + (<span class='no'>b_var1</span> * <span class='no'>inv_trend</span>)
<span class='no'>var2</span> <span class='kw'>&lt;-</span> (<span class='no'>s_var2</span> * <span class='no'>trend</span>) + (<span class='no'>b_var2</span> * <span class='no'>inv_trend</span>)
<span class='co'>#### end simulated data creation ####</span>

<span class='co'>### Create raster stack of predictor variables</span>
<span class='no'>pred_var_stack</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>raster</span><span class='kw ns'>::</span><span class='fu'><a href='https://www.rdocumentation.org/packages/raster/topics/stack'>stack</a></span>(<span class='no'>var1</span>, <span class='no'>var2</span>)
<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/names'>names</a></span>(<span class='no'>pred_var_stack</span>) <span class='kw'>&lt;-</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/c'>c</a></span>(<span class='st'>"var1"</span>,<span class='st'>"var2"</span>)
<span class='co'>### scale rasters to training data</span>
<span class='no'>pred_var_stack_scaled</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='scale_prediction_rasters.html'>scale_prediction_rasters</a></span>(<span class='no'>pred_var_stack</span>, <span class='no'>params</span>, <span class='kw'>verbose</span> <span class='kw'>=</span> <span class='fl'>0</span>)
<span class='co'>### Predict raster (single chunk, not in parallel) </span>
<span class='no'>pred_rast</span> <span class='kw'>&lt;-</span> <span class='fu'>KLR_raster_predict</span>(<span class='no'>pred_var_stack_scaled</span>, <span class='kw'>ngb</span> <span class='kw'>=</span> <span class='no'>ngb</span>, <span class='no'>params</span>, <span class='kw'>split</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>ppside</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
                                <span class='kw'>progress</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>parallel</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)
<span class='co'>### plot with simulated sites</span>
<span class='kw pkg'>rasterVis</span><span class='kw ns'>::</span><span class='fu'><a href='https://www.rdocumentation.org/packages/rasterVis/topics/levelplot-methods'>levelplot</a></span>(<span class='no'>pred_rast</span>, <span class='kw'>margin</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>par.settings</span><span class='kw'>=</span><span class='fu'>viridisTheme</span>()) +
<span class='fu'>layer</span>(<span class='fu'>sp.points</span>(<span class='fu'>sp.points</span>(<span class='fu'>SpatialPoints</span>(<span class='no'>coords</span>), <span class='kw'>pch</span><span class='kw'>=</span><span class='fl'>15</span>, <span class='kw'>cex</span> <span class='kw'>=</span> <span class='fl'>2.25</span>, <span class='kw'>col</span> <span class='kw'>=</span> <span class='st'>"red"</span>)), <span class='kw'>columns</span><span class='kw'>=</span><span class='fl'>1</span>)

   <span class='co'>## Or with parallel backend ##</span>
<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/library'>library</a></span>(<span class='st'>"doParallel"</span>)
<span class='co'>### create and register parallel backend</span>
<span class='no'>cl</span> <span class='kw'>&lt;-</span> <span class='fu'>makeCluster</span>(<span class='fu'>detectCores</span>())
<span class='kw pkg'>doParallel</span><span class='kw ns'>::</span><span class='fu'><a href='https://www.rdocumentation.org/packages/doParallel/topics/registerDoParallel'>registerDoParallel</a></span>(<span class='no'>cl</span>)

<span class='co'>### Use same KLR_raster_predict function with parallel = TRUE</span>
<span class='no'>pred_rast_list</span> <span class='kw'>&lt;-</span> <span class='fu'>KLR_raster_predict</span>(<span class='no'>pred_var_stack_scaled</span>, <span class='kw'>ngb</span> <span class='kw'>=</span> <span class='no'>ngb</span>, <span class='no'>params</span>, <span class='kw'>split</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>ppside</span> <span class='kw'>=</span> <span class='fl'>5</span>,
                                     <span class='kw'>progress</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>parallel</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>output</span> <span class='kw'>=</span> <span class='st'>"list"</span>,
                                     <span class='kw'>save_loc</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>overwrite</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>cols</span> <span class='kw'>=</span> <span class='no'>cols</span>, <span class='kw'>rows</span> <span class='kw'>=</span> <span class='no'>rows</span>)
<span class='co'>#&gt; Splitting rasters into blocks </span>
<span class='co'>#&gt; Predicting splits in parallel on 8 cores</span>
<span class='co'>### Merge list back to a single raster</span>
<span class='no'>pred_rast</span> <span class='kw'>&lt;-</span>  <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/do.call'>do.call</a></span>(<span class='no'>merge</span>, <span class='no'>pred_rast_list</span>)
<span class='co'>### plot with simulated sites</span>
<span class='kw pkg'>rasterVis</span><span class='kw ns'>::</span><span class='fu'><a href='https://www.rdocumentation.org/packages/rasterVis/topics/levelplot-methods'>levelplot</a></span>(<span class='no'>pred_rast</span>, <span class='kw'>margin</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>par.settings</span><span class='kw'>=</span><span class='fu'>viridisTheme</span>()) +
  <span class='fu'>layer</span>(<span class='fu'>sp.points</span>(<span class='fu'>sp.points</span>(<span class='fu'>SpatialPoints</span>(<span class='no'>coords</span>), <span class='kw'>pch</span><span class='kw'>=</span><span class='fl'>15</span>, <span class='kw'>cex</span> <span class='kw'>=</span> <span class='fl'>2.25</span>, <span class='kw'>col</span> <span class='kw'>=</span> <span class='st'>"red"</span>)), <span class='kw'>columns</span><span class='kw'>=</span><span class='fl'>1</span>)

<span class='co'># }</span><div class='input'>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#value">Value</a></li>

      <li><a href="#details">Details</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Matthew Harris.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
   </div>

  

  </body>
</html>

